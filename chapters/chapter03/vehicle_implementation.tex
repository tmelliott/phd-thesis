\section{Implementing the \rt{} \pf{}}
\label{sec:particle-filter}


The next major step in this work was to implement the model in real-time using \Cpp{}. Our implementation involves a single call from the \Rstats{} package \pkg{transitr} which commences an infinite loop within \Cpp{} which:
\begin{enumerate}
\item fetches the lastest observations,
\item attaches them to an existing vehicle, or creates a new one,
\item updates or initialises vehicle states using the particle filter model described in \cref{sec:vehicle_model}, and
\item estimates average road speeds as vehicles traverse the network as described in \cref{sec:vehicle_speeds}.
\end{enumerate}
During the process of coding our implementation (\cref{sec:pf_implementation}), we inevitably ran into issues, some of which are related to computational complexity, while others are due to imperfections with the data (\cref{sec:pf_issues}). Once the implementation was complete, we needed to estimate the parameters (such as system noise and measurement error) for the model.


To assess the real-time performance of the model and our \pf{} implementation, we created a virtual real-time server which serves historical data. This means we can both process the data faster---we do not need to wait in real-time for new observations---and allows us to run the model on the same data with different settings and parameter values for comparison. We used (a subset of) data from Tuesday 8~October~2018 for the simulations used in \cref{sec:pf_issues,sec:pf_params}, which were carried out on a virtual machine with 8~Intel Xeon 3.00GHz CPU cores and 32~GB of memory, running Ubuntu 16.04 and \Rstats{}~3.4.1. The results themselves were processed locally using \Rstats{}~3.6.0.





\input{chapters/chapter03/pf_computation.tex}
\input{chapters/chapter03/pf_issues.tex}
\input{chapters/chapter03/data_issues.tex}
\input{chapters/chapter03/parameter_selection.tex}
